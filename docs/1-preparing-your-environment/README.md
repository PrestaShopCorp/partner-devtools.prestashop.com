---
title: Preparing Your Environment for PrestaShop Cloud Services
---

# Preparing Your Environment for PrestaShop Cloud Services

To use PrestaShop Cloud Services, you need to **have a PrestaShop instance running and available online**. 

You can either choose to install PrestaShop and configure it yourself, or use a Docker image containing a preconfigured PrestaShop environment.

## Installing PrestaShop Manually

You can install PrestaShop manually by following the [PrestaShop Open Source documentation](https://devdocs.prestashop-project.org/8/basics/installation/).

To connect your PrestaShop to PrestaShop Account, you will need to **create an SSH tunnel** that will allow your PrestaShop to communicate with the Internet.

The most convenient solution is to use [ngrok](https://ngrok.com/docs), but the free version will provide you with a different URL everytime you restart your machine, which requires reconfiguring the database each time. This solution thus requires either using the payable solution or performing advanced configuration on the database.

## Installing a Preconfigured PrestaShop

If you're not familiar with PrestaShop development, you can follow this procedure to install PrestaShop through Docker Compose, which will allow you to download and launch a Docker image containing a PrestaShop instance with a **preconfigured environment and SSH tunnel**.

### Prerequisites

If needed, install [Docker and Docker Compose](https://docs.docker.com/compose/install/) under v2.

### Installation

Clone the Git repository:

```
git clone https://github.com/PrestaShopCorp/partner-devtools.prestashop.com.git
```

In the cloned directory, create your `.env` file:

```
cp .env.example .env
```

Customize your `.env` file:

```
MODULE_NAME=CHANGEME123
PORT=8080
PMA_PORT=8081
DB_PORT=3307
```

- Replace `CHANGEME123` with the name of your module.
- If needed, replace `8080` with the port for PrestaShop and the HTTP proxy client.
- If needed, replace `8081` with the port for phpMyAdmin.
- If needed, replace `3307` with the port for MySQL.

::: tip
See [.env file reference](#env-file-reference) to know more about other environment variables you can set.
:::

Copy your module folder into the following tree structure:

```
|-- modules
|   |-- CHANGEME123
|   |-- rbm_example
|   |-- rbm_example_stairstep
```

Where `CHANGEME123` is the folder containing your module, as named beforehand in your `.env` file.

::: tip
If you do not have a module yet, you can leave the folder empty, or use the [module generator](https://validator.prestashop.com/generator).
:::

Run the project:

```
./install.sh
```

### Configuration

#### .env file reference

If needed, you can customize the `.env` file:

| Environment variable | Description                                                                                   | Default value                           |
| -------------------- | --------------------------------------------------------------------------------------------- | --------------------------------------- |
| PS_NAME              | Defines the subdomain for the HTTP tunnel. Automatically generated by the localtunnel client. | CHANGEME123                             |
| MODULE_NAME          | Defines the subdomain for the HTTP tunnel. To set before the installation.                    | CHANGEME123                             |
| TUNNEL_DOMAIN        | Defines the tunnel domain. Can be changed if you host your own localtunnel server.            | localtunnel.distribution.prestashop.net |
| PS_LANGUAGE          | Changes the default language installed on the PrestaShop.                                     | en                                      |
| PS_COUNTRY           | Changes the default country installed on the PrestaShop.                                      | GB                                      |
| PS_ALL_LANGUAGES     | Installs all the existing languages for the current version.                                  | 0                                       |
| ADMIN_MAIL           | Overrides the default admin email address.                                                    | admin@prestashop.com                    |
| ADMIN_PASSWD         | Overrides the default admin password.                                                         | prestashop                              |
| PORT                 | Defines the port for the PrestaShop and the HTTP proxy client.                                | 8080                                    |
| PMA_PORT             | Defines the port for PhpMyAdmin.                                                              | 8081                                    |
| DB_PORT              | Defines the port for MySQL.                                                                   | 3307                                    |


#### install.sh file reference

Let's break the `install.sh` file down.

First, a network layer is created for the container. If the network already exists, this step is skipped:

```
# Create a network for containers to communicate
NETWORK_NAME=prestashop_net
if [ -z $(docker network ls --filter name=^${NETWORK_NAME}$ --format="{{ .Name }}") ] ; then
  echo -e "Create ${NETWORK_NAME} network for containers to communicate"
  docker network create ${NETWORK_NAME} ;
else
  echo -e "Network ${NETWORK_NAME} already exists, skipping"
fi
```

If you want to use another network, you will need to edit `docker-compose.yml`.

The script creates a HTTP tunnel container which will generate your shop URL:

```
# Create HTTP tunnel container
echo -e "Create HTTP tunnel service"
if [[ `uname -m` == 'arm64' ]]; then
  DOCKER_SCAN_SUGGEST=false docker-compose -f docker-compose.yml -f docker-compose.arm64.yml up -d --no-deps --force-recreate --build prestashop_tunnel
else
  DOCKER_SCAN_SUGGEST=false docker-compose up -d --no-deps --force-recreate --build prestashop_tunnel
fi

echo -e "Checking if HTTP tunnel is available..."
LOCAL_TUNNEL_READY=`docker inspect -f {{.State.Running}} ps-tunnel.local`
until (("$LOCAL_TUNNEL_READY"=="true"))
do
  echo -e "Waiting for confirmation of HTTP tunnel service startup"
  sleep 5
done;
echo -e "HTTP tunnel is available, let's continue !"
```

The script sets the subdomain in the `.env` file. If it already exists, this step is skipped, and `PS_NAME` is replaced:

```
# Setting up env file
echo -e "Setting up env file"

ENV_FILE=.env
SUBDOMAIN_NAME=`docker logs ps-tunnel.local 2>/dev/null | awk -F '/' '{print $3}' | awk -F"." '{print $1}' | awk 'END{print}' | tr -d "[:space:]"`
if [ ! -s "$ENV_FILE" ]; then
  echo -e "Create env file"
  cp .env.example $ENV_FILE
fi

sed -i $SED_OPTIONS -E "s|(PS_NAME=).*|PS_NAME=${SUBDOMAIN_NAME}|g" $ENV_FILE
if [[ "$OSTYPE" == "darwin"* ]]; then
  rm -f "${ENV_FILE}${SED_OPTIONS}"
fi
PS_NAME=$(readEnv PS_NAME $ENV_FILE)
```

A small trick allows you to always get the same URL:

```
# Handle restart to avoid new subdomain
TUNNEL_FILE=tunnel/.config
if [ ! -s "$TUNNEL_FILE" ]; then
  echo -e "Handle restart to avoid new subdomain"
  echo $SUBDOMAIN_NAME > $TUNNEL_FILE
fi
docker cp $TUNNEL_FILE ps-tunnel.local:/tmp/.config
```

The script creates the MySQL and PrestaShop container:

```
# Create MySQL and PrestaShop service
echo -e "Create MySQL & PrestaShop service"
if [[ `uname -m` == 'arm64' ]]; then
  DOCKER_SCAN_SUGGEST=false docker-compose -f docker-compose.yml -f docker-compose.arm64.yml up -d --no-deps --force-recreate --build prestashop_rbm_shop prestashop_rbm_db
else
  DOCKER_SCAN_SUGGEST=false docker-compose up -d --no-deps --force-recreate --build prestashop_rbm_db prestashop_rbm_shop
fi
```

The script waits until PrestaShop is ready to use:

```
echo -e "Checking if PrestaShop is available..."
LOCAL_PORT=$(readEnv PORT $ENV_FILE)
if [ -z $LOCAL_PORT ] ; then
  LOCAL_PORT=`docker port ps-rbm.local 80 | awk -F ':' '{print $2}' | tr -d "[:space:]"`
fi

PRESTASHOP_READY=`curl -s -o /dev/null -w "%{http_code}" localhost:$LOCAL_PORT`
until (("$PRESTASHOP_READY"=="302"))
do
  # avoid infinite loop...
  PRESTASHOP_READY=`curl -s -o /dev/null -w "%{http_code}" localhost:$LOCAL_PORT`
  echo "Waiting for confirmation of PrestaShop is available (${PRESTASHOP_READY})"
  sleep 5
done;
```

Finaly, your PrestaShop URLs for back office and front office display:

```
BO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net/admin-dev
FO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net
```

#### PrestaShop URL Commands

Get your URLs:

```
./get-url.sh

BO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net/admin-dev
FO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net
```

Update the URLs:

```
./update-domain.sh
Updating PrestaShop domains ...

BO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net/admin-dev
FO Url: http://CHANGEME123.localtunnel.distribution.prestashop.net
```

### Troubleshooting

#### Mac OS

If you get the following error:

```
Mac network_mode: "host" not working as expected
```

Follow this [link](https://docs.docker.com/desktop/networking/#known-limitations-use-cases-and-workarounds) for a workaround.

#### Error on database port

```
ERROR: for prestashop_rbm_db  Cannot start service prestashop_rbm_db: Ports are not available: listen tcp 0.0.0.0:3307:
```

Override the `DB_PORT` port in the [.env file](#env-file-reference).

#### The database does not start

If the database does not start because of the following error:

```
[ERROR] Plugin 'InnoDB' init function returned error.
[ERROR] Plugin 'InnoDB' registration as a STORAGE ENGINE failed.
```

Delete the `./mysql/` folder and relaunch everything.

#### Error within ps-tunnel.local

```
Bind for 0.0.0.0:8080 failed: port is already allocated
```

Override the `PORT` port in the [.env file](#env-file-reference).

#### Error within phpmyadmin.local

```
Bind for 0.0.0.0:8081 failed: port is already allocated
```

Override the `PMA_PORT` port in the [.env file](#env-file-reference).

#### Error: docker env not changed

Use the debug mode to force Docker to rebuild images:

```
export TUNNEL_DEBUG=true && ./install.sh
```

#### Error: operand expected

```
((: ==true : syntax error: operand expected (error token is "==true ")
```

Update your version of Docker Compose (>= 1.27.0).